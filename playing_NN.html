<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Network Visualization</title>
    <style>
        .container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .inputs {
            width: 30%;
        }

        .inputs label {
            display: block;
            margin: 10px 0;
        }

        .inputs button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .inputs button:hover {
            background-color: #45a049;
        }

        .network {
            width: 65%;
        }

        svg {
            border: 1px solid black;
        }

        .neuron {
            fill: lightblue;
            stroke: black;
            stroke-width: 1;
        }

        .link {
            stroke-width: 2;
        }

        .bias-label {
            font-size: 12px;
            fill: black;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="inputs">
            <h2>Inputs</h2>
            <label>Tank Level: <input type="number" id="input1" value="65.4"></label>
            <label>Cl Set: <input type="number" id="input2" value="0.7"></label>
            <label>Pump: <input type="number" id="input3" value="1"></label>
            <label>UV%: <input type="number" id="input4" value="34.5615"></label>
            <label>Flow: <input type="number" id="input5" value="98.9365"></label>
            <label>Influent Turbidity: <input type="number" id="input6" value="1.93"></label>
            <label>Effluent Turbidity: <input type="number" id="input7" value="0.88"></label>
            <label>pH: <input type="number" id="input8" value="8.1"></label>
            <label>Coagulant PPM: <input type="number" id="input9" value="0.0"></label>
            <button onclick="drawNetwork()">Calculate</button>
        </div>
        <div class="network">
            <h2>Neural Network</h2>
            <svg id="network" width="800" height="600"></svg>
        </div>
    </div>
    <script>
        // Normalization parameters
        const normalization = {
            input1: { mu: 63.6731, sigma: 13.0110 },
            input2: { mu: 0.7181, sigma: 0.0714 },
            input3: { mu: 1.6355, sigma: 0.4813 },
            input4: { mu: 30.5615, sigma: 4.7297 },
            input5: { mu: 92.9365, sigma: 5.4898 },
            input6: { mu: 1.6341, sigma: 1.8581 },
            input7: { mu: 0.6325, sigma: 0.4388 },
            input8: { mu: 8.6380, sigma: 0.4105 },
            input9: { mu: 2.0431, sigma: 5.9868 }
        };

        // Neural network parameters
        const weights = {
            inputToHidden: [
                [-1.5254, -2.8213, -2.0056, -0.5310, 0.0872, -2.6420, 2.2675, 1.6801, -2.4497],
                [0.1749, 1.1470, 0.0110, 0.9485, -0.7185, -0.5225, 0.5567, -3.0506, 0.2267],
                [-0.9500, -1.6201, 0.7642, -0.7214, 0.0942, -0.7018, 1.4409, 0.2737, -2.2615],
                [-0.4291, -0.1496, -0.1680, -1.5874, 0.3165, 0.6999, 0.9615, 1.7618, -1.9396],
                [-0.4147, 1.6260, -0.9535, 1.3389, 0.4307, 0.1598, 0.8035, -1.2008, 1.5433],
                [2.5432, 2.2072, 0.4781, -2.3549, -0.0015, -0.7786, 0.1003, -0.3360, -4.3691]
            ],
            hiddenToOutput: [2.6014, -2.9345, 2.8387, -2.7334, 4.3664, 2.6695]
        };

        const biases = {
            hidden: [2.1953, 0.3133, 2.1811, -0.6922, 5.7215, 2.3570],
            output: 4.1839
        };

        const drawNetwork = () => {
            const svg = document.getElementById("network");
            svg.innerHTML = "";

            const inputLayerX = 100;
            const hiddenLayerX = 400;
            const outputLayerX = 700;
            const neuronRadius = 20;

            const inputLayerY = Array.from({ length: 9 }, (_, i) => 50 + i * 60);
            const hiddenLayerY = Array.from({ length: 6 }, (_, i) => 100 + i * 80);
            const outputLayerY = [300];

            // Normalize inputs
            const inputs = Array.from({ length: 9 }, (_, i) => {
                const rawValue = parseFloat(document.getElementById(`input${i + 1}`).value);
                const { mu, sigma } = normalization[`input${i + 1}`];
                return (rawValue - mu) / sigma;
            });

            // Draw input neurons
            inputLayerY.forEach((y, i) => {
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", inputLayerX);
                circle.setAttribute("cy", y);
                circle.setAttribute("r", neuronRadius);
                circle.setAttribute("class", "neuron");
                svg.appendChild(circle);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", inputLayerX - 60);
                text.setAttribute("y", y + 5);
                text.textContent = inputs[i].toFixed(2);
                svg.appendChild(text);
            });

            // Draw hidden neurons and calculate outputs
            const hiddenOutputs = [];
            hiddenLayerY.forEach((y, i) => {
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", hiddenLayerX);
                circle.setAttribute("cy", y);
                circle.setAttribute("r", neuronRadius);
                circle.setAttribute("class", "neuron");
                svg.appendChild(circle);

                // Calculate weighted sum and apply ReLU activation
                const weightedSum = inputs.reduce((sum, input, j) => sum + input * weights.inputToHidden[i][j], biases.hidden[i]);
                const output = Math.max(0, weightedSum); // ReLU activation
                hiddenOutputs.push(output);

                // Display weighted sum and bias
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", hiddenLayerX + 30);
                text.setAttribute("y", y + 5);
                text.textContent = output.toFixed(2);
                svg.appendChild(text);

                const biasText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                biasText.setAttribute("class", "bias-label");
                biasText.setAttribute("x", hiddenLayerX - 5);
                biasText.setAttribute("y", y - 25);
                biasText.textContent = `B: ${biases.hidden[i].toFixed(2)}`;
                svg.appendChild(biasText);
            });

            // Draw output neuron
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", outputLayerX);
            circle.setAttribute("cy", outputLayerY[0]);
            circle.setAttribute("r", neuronRadius);
            circle.setAttribute("class", "neuron");
            svg.appendChild(circle);

            const output = hiddenOutputs.reduce((sum, hiddenOutput, i) => sum + hiddenOutput * weights.hiddenToOutput[i], biases.output);
            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", outputLayerX + 30);
            text.setAttribute("y", outputLayerY[0] + 5);
            text.textContent = output.toFixed(2);
            svg.appendChild(text);

            const biasText = document.createElementNS("http://www.w3.org/2000/svg", "text");
            biasText.setAttribute("class", "bias-label");
            biasText.setAttribute("x", outputLayerX - 5);
            biasText.setAttribute("y", outputLayerY[0] - 25);
            biasText.textContent = `B: ${biases.output.toFixed(2)}`;
            svg.appendChild(biasText);

            // Draw links
            inputLayerY.forEach((inputY, i) => {
                hiddenLayerY.forEach((hiddenY, j) => {
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", inputLayerX + neuronRadius);
                    line.setAttribute("y1", inputY);
                    line.setAttribute("x2", hiddenLayerX - neuronRadius);
                    line.setAttribute("y2", hiddenY);
                    line.setAttribute("class", "link");
                    line.setAttribute("stroke", weights.inputToHidden[j][i] > 0 ? "green" : "red");
                    line.setAttribute("stroke-width", Math.max(1, Math.abs(weights.inputToHidden[j][i]) * 2));
                    svg.appendChild(line);
                });
            });

            hiddenLayerY.forEach((hiddenY, i) => {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", hiddenLayerX + neuronRadius);
                line.setAttribute("y1", hiddenY);
                line.setAttribute("x2", outputLayerX - neuronRadius);
                line.setAttribute("y2", outputLayerY[0]);
                line.setAttribute("class", "link");
                line.setAttribute("stroke", weights.hiddenToOutput[i] > 0 ? "green" : "red");
                line.setAttribute("stroke-width", Math.max(1, Math.abs(weights.hiddenToOutput[i]) * 2));
                svg.appendChild(line);
            });
        };

        // Initial draw
        drawNetwork();
    </script>
</body>
</html>

