<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARAKAKO UR BILTEGIA</title>
    <!-- Incluye la librería de Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>ARAKAKO UR BILTEGIA</h1>
    <div id="grafica" style="width:100%;height:500px;"></div>

    <script>
        // Tu API Key de ThingSpeak
        const apiKey = 'HONT6RJG2VNEETZJ';
        // El ID del canal de ThingSpeak
        const channelID = 1025220;
        // URL de la API de ThingSpeak para obtener los datos (8000 resultados)
        const url = `https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${apiKey}&results=8000`;

        // Función para obtener los datos de ThingSpeak
        async function obtenerDatos() {
            try {
                const respuesta = await fetch(url);
                const datos = await respuesta.json();
                return datos.feeds;
            } catch (error) {
                console.error('Error al obtener los datos:', error);
            }
        }

        // Función para dibujar las gráficas con Plotly
        async function dibujarGraficas() {
            const feeds = await obtenerDatos();
            const fechas = feeds.map(feed => feed.created_at);

            // Datos para field2, field3 y field4
            const valoresField2 = feeds.map(feed => parseFloat(feed.field2));
            const valoresField3 = feeds.map(feed => parseFloat(feed.field3));
            const valoresField4 = feeds.map(feed => parseFloat(feed.field4));

            // Crear trazos para cada campo
            const trazoField2 = {
                x: fechas,
                y: valoresField2,
                type: 'scatter',
                mode: 'lines',
                name: '% BILTEGI 1',
                line: {color: 'blue'}
            };

            const trazoField3 = {
                x: fechas,
                y: valoresField3,
                type: 'scatter',
                mode: 'lines',
                name: '% BILTEGI 2',
                line: {color: 'green'}
            };

            const trazoField4 = {
                x: fechas,
                y: valoresField4,
                type: 'scatter',
                mode: 'lines',
                name: '% BILTEGI 3',
                line: {color: 'red'}
            };

            // Layout de la gráfica
            const layout = {
                title: '',
                xaxis: {title: 'Fecha'},
                yaxis: {title: 'Valor'}
            };

            // Dibujar las tres gráficas en el mismo contenedor
            Plotly.newPlot('grafica', [trazoField2, trazoField3, trazoField4], layout);
        }

        // Llama a la función para dibujar las gráficas cuando la página se cargue
        window.onload = dibujarGraficas;
    </script>
</body>
</html>
